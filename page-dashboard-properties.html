<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="advanced search, agency, agent, classified, directory, house, listing, property, real estate, real estate agency, real estate agent, realestate, realtor, rental">
<meta name="description" content="Homez - Real Estate HTML Template">
<meta name="CreativeLayers" content="ATFN">
<!-- css file -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/ace-responsive-menu.css">
<link rel="stylesheet" href="css/menu.css">
<link rel="stylesheet" href="css/fontawesome.css">
<link rel="stylesheet" href="css/flaticon.css">
<link rel="stylesheet" href="css/bootstrap-select.min.css">
<link rel="stylesheet" href="css/ud-custom-spacing.css">
<link rel="stylesheet" href="css/animate.css">
<link rel="stylesheet" href="css/slider.css">
<link rel="stylesheet" href="css/jquery-ui.min.css">
<link rel="stylesheet" href="css/magnific-popup.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/dashbord_navitaion.css">
<!-- Responsive stylesheet -->
<link rel="stylesheet" href="css/responsive.css">
<!-- Title -->
<title>Asesorista</title>
<!-- Favicon -->
<link rel="apple-touch-icon" href="images/favicon.png" />
<link
  rel="shortcut icon"
  type="image/x-icon"
  href="images/favicon.png"
/>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
<div class="wrapper">
  <div class="preloader"></div>
  
  <!-- Main Header Nav -->
  <header class="header-nav nav-innerpage-style menu-home4 dashboard_header main-menu">
    <!-- Ace Responsive Menu -->
    <nav class="posr"> 
      <div class="container-fluid pr30 pr15-xs pl30 posr menu_bdrt1">
        <div class="row align-items-center justify-content-between">
          <div class="col-6 col-lg-auto">
            <div class="text-center text-lg-start d-flex align-items-center">
              <div class="dashboard_header_logo position-relative me-2 me-xl-5">
                <a href="index.html" class="logo"><img src="images/main-logo.png" alt="" style="width: 180px;"></a>
              </div>
              <div class="fz20 ms-2 ms-xl-5">
                <a href="#" class="dashboard_sidebar_toggle_icon text-thm1 vam"><img src="images/dark-nav-icon.svg" alt=""></a>
              </div>
            </div>
          </div>
          <div class="d-none d-lg-block col-lg-auto">
            <!-- Responsive Menu Structure-->
            <ul id="respMenu" class="ace-responsive-menu" data-menu-style="horizontal">
            </ul>
          </div>
          <div class="col-6 col-lg-auto">
            <div class="text-center text-lg-end header_right_widgets">
              <ul class="mb0 d-flex justify-content-center justify-content-sm-end p-0">
                <li class=" user_setting">
                  <div class="dropdown">
                    <a class="btn" href="#" data-bs-toggle="dropdown">
                      <img src="images/favicon.png" style="width: 40px;" alt="user.png"> 
                    </a>
                    <div class="dropdown-menu">
                      <div class="user_setting_content">
                        <p class="fz15 fw400 ff-heading mt30">MANAGE LISTINGS</p>
                        <a class="dropdown-item" href="page-dashboard-add-property.html"><i class="flaticon-new-tab mr10"></i>Agregar propiedad</a>
                        <a class="dropdown-item active" href="page-dashboard-properties.html"><i class="flaticon-home mr10"></i>Mis propiedades</a>
                        <p class="fz15 fw400 ff-heading mt30">MANAGE ACCOUNT</p>
                        <a class="dropdown-item" href="javascript:void(0);" onclick="logout()"><i class="flaticon-exit mr10"></i>Logout</a>
                      </div>
                    </div>
                    <script>
                      function logout() {
                          // Eliminar cookies/session aquí
                          document.cookie = "session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                          
                          // Redirigir al usuario
                          redirectToAdmin();
                      }

                      function redirectToAdmin() {
                          window.location.replace('administrador.html');
                      }
                  </script>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>
  <!-- Menu In Hiddn SideBar -->
  <div class="rightside-hidden-bar">
    <div class="hsidebar-header">
      <div class="sidebar-close-icon"><span class="far fa-times"></span></div>
      <h4 class="title">Welcome to Realton</h4>
    </div>
    <div class="hsidebar-content">
      <div class="hiddenbar_navbar_content">
        <div class="hiddenbar_navbar_menu">
          <ul class="navbar-nav">
            <li class="nav-item"> <a class="nav-link" href="" role="button">Apartments</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Bungalow</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Houses</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Loft</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Office</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Townhome</a></li>
            <li class="nav-item"> <a class="nav-link" href="" role="button">Villa</a></li>
          </ul>
        </div>
        <div class="hiddenbar_footer position-relative bdrt1">
          <div class="row pt45 pb30 pl30">
            <div class="col-auto">
              <div class="contact-info">
                <p class="info-title dark-color">Total Free Customer Care</p>
                <h6 class="info-phone dark-color"><a href="+(0)-123-050-945-02">+(0) 123 050 945 02</a></h6>
              </div>
            </div>
            <div class="col-auto">
              <div class="contact-info">
                <p class="info-title dark-color">Nee Live Support?</p>
                <h6 class="info-mail dark-color"><a href="mailto:hi@homez.com">hi@homez.com</a></h6>
              </div>
            </div>
          </div>
          <div class="row pt30 pb30 bdrt1">
            <div class="col-auto">
              <div class="social-style-sidebar d-flex align-items-center pl30">
                <h6 class="me-4 mb-0">Follow us</h6>
                <a class="me-3" href=""><i class="fab fa-facebook-f"></i></a>
                <a class="me-3" href=""><i class="fab fa-twitter"></i></a>
                <a class="me-3" href=""><i class="fab fa-instagram"></i></a>
                <a class="me-3" href=""><i class="fab fa-linkedin-in"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--End Menu In Hiddn SideBar --> 
  <!-- Mobile Nav  -->
  <div id="page" class="mobilie_header_nav stylehome1">
    <div class="mobile-menu">
      <div class="header innerpage-style">
        <div class="menu_and_widgets">
          <div class="mobile_menu_bar d-flex justify-content-between align-items-center">
            <a href="index.html" class="logo"><img src="images/main-logo.png" alt="" style="width: 180px;"></a>
            <li class=" user_setting">
              <div class="dropdown">
                <a class="btn" href="#" data-bs-toggle="dropdown">
                  <img src="images/favicon.png" style="width: 40px;" alt="user.png"> 
                </a>
                <div class="dropdown-menu">
                  <div class="user_setting_content">
                    <p class="fz15 fw400 ff-heading mt30">MANAGE LISTINGS</p>
                    <a class="dropdown-item" href="page-dashboard-add-property.html"><i class="flaticon-new-tab mr10"></i>Agregar propiedad</a>
                    <a class="dropdown-item" href="page-dashboard-order.html"><i class="flaticon-home mr10"></i>Mis propiedades</a>
                    <p class="fz15 fw400 ff-heading mt30">MANAGE ACCOUNT</p>
                    <a class="dropdown-item" href="javascript:void(0);" onclick="logout()"><i class="flaticon-exit mr10"></i>Logout</a>
                  </div>
                </div>
              </div>
              
            </li>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard_content_wrapper">
    <div class="dashboard dashboard_wrapper pr30 pr0-md">
      <div class="dashboard__sidebar d-none d-lg-block">
        <div class="dashboard_sidebar_list">
          <p class="fz15 fw400 ff-heading">MANAGE LISTINGS</p>
          <div class="sidebar_list_item ">
            <a href="page-dashboard-add-property.html" class="items-center"><i class="flaticon-new-tab mr15"></i>Agregar propiedad</a>
          </div>
          <div class="sidebar_list_item ">
            <a href="page-dashboard-properties.html" class="items-center -is-active"><i class="flaticon-home mr15"></i>Mis propiedades</a>
          </div>
          <p class="fz15 fw400 ff-heading mt30">MANAGE ACCOUNT</p>
          <div class="sidebar_list_item ">
            <a href="javascript:void(0);" onclick="logout()" class="items-center"><i class="flaticon-logout mr15"></i>Logout</a>
          </div>
        </div>
      </div>
      <div class="dashboard__main pl0-md">
        <div class="dashboard__content property-page bgc-f7">
          <div class="row pb40 d-block d-lg-none">
            <div class="col-lg-12">
              <div class="dashboard_navigationbar">
                <div class="dropdown">
                  <button onclick="myFunction()" class="dropbtn"><i class="fa fa-bars pr10"></i> Dashboard Navigation</button>
                  <ul id="myDropdown" class="dropdown-content">
                    <li><p class="fz15 fw400 ff-heading mt30 pl30">MANAGE LISTINGS</p></li>
                    <li><a href="page-dashboard-add-property.html"><i class="flaticon-new-tab mr10"></i>Agregar propiedad</a></li>
                    <li class="active"><a href="page-dashboard-properties.html"><i class="flaticon-home mr10"></i>Mis propiedades</a></li>
                    <li><p class="fz15 fw400 ff-heading mt30 pl30">MANAGE ACCOUNT</p></li>
                    <li><a class="" href="javascript:void(0);" onclick="logout()"><i class="flaticon-exit mr10"></i>Logout</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center pb40">
            <div class="col-xxl-3">
              <div class="dashboard_title_area">
                <h2>Mis propiedades</h2>
                <p class="text">Administra el contenido de las propiedades</p>
              </div>
            </div>
            <div class="col-xxl-9">
              <div class="dashboard_search_meta d-md-flex align-items-center justify-content-xxl-end">
                <div class="item1 mb15-sm">
                  <div class="search_area">
                    <input type="text" class="form-control bdrs12" placeholder="Nombre o dirección">
                    <label><span class="flaticon-search"></span></label>
                  </div>
                </div>
                <a href="page-dashboard-add-property.html" class="ud-btn btn-thm" style="margin-left: 20px;">Agregar propiedad<i class="fal fa-arrow-right-long"></i></a>
              </div>
            </div>            
          </div>
          <div class="row">
            <div class="col-xl-12">
                <div class="ps-widget bgc-white bdrs12 default-box-shadow2 p30 mb30 overflow-hidden position-relative">
                    <div class="packages_table table-responsive">
                        <table class="table-style3 table at-savesearch">
                            <thead class="t-head">
                                <tr>
                                    <th scope="col">Propiedad</th>
                                    <th scope="col">Precio</th>
                                    <th scope="col">Amenidades</th>
                                    <th scope="col">Medidas</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="t-body">
                                <!-- Las filas se añadirán dinámicamente desde JavaScript -->
                            </tbody>
                        </table>
                        <div class="mbp_pagination text-center mt30">
                          <ul class="page_navigation">
                            <li class="page-item">
                              <a class="page-link" href="#"> <span class="fas fa-angle-left"></span></a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item active" aria-current="page">
                              <a class="page-link" href="#">2 <span class="sr-only">(current)</span></a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item"><a class="page-link" href="#">4</a></li>
                            <li class="page-item"><a class="page-link" href="#">5</a></li>
                            <li class="page-item"><a class="page-link" href="#">...</a></li>
                            <li class="page-item"><a class="page-link" href="#">20</a></li>
                            <li class="page-item">
                              <a class="page-link" href="#"><span class="fas fa-angle-right"></span></a>
                            </li>
                          </ul>
                        </div>
                    </div>
                </div>
            </div>
          </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirmar eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                ¿Está seguro de que desea eliminar esta propiedad? Esta acción es irreversible.
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="color: white;">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmDelete" style="color: white;">Eliminar</button>
              </div>
            </div>
          </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.22.2"></script>
        <script>
          const SUPABASE_URL = 'https://fhowgaxtehxvtcpiziyy.supabase.co'
          const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZob3dnYXh0ZWh4dnRjcGl6aXl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTA2OTA1NjQsImV4cCI6MjAwNjI2NjU2NH0.ZOc7XrEmDevg35_FT-s0HUQgA4uvq900D80j31G7R20'

          const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
                  </script>
                    <script>

                  document.querySelector('.search_area input').addEventListener('input', function() {
                      filtrarPropiedadesPorNombre(this.value);
                  });

          
                  async function obtenerPropiedades(pagina = 1, nombre = '') {
                  const elementosPorPagina = 9;
                  const inicio = (pagina - 1) * elementosPorPagina;
                  const fin = inicio + elementosPorPagina - 1;

                  let query = _supabase.from('propiedades').select('*').range(inicio, fin);

                  if (nombre) {
                      query = query.ilike('nombre', `%${nombre}%`);
                  }

                  const { data, error } = await query;

                  if (error) {
                      console.error("Error obteniendo propiedades:", error);
                      return;
                  }
                  return data;
              }

              async function filtrarPropiedadesPorNombre(nombre) {
                  paginaActual = 1; // Reinicia la página al filtrar
                  await llenarTabla(paginaActual, nombre);

                  // Actualiza la paginación
                  const { count } = await _supabase
                      .from('propiedades')
                      .select('*', { count: 'exact' })
                      .ilike('nombre', `%${nombre}%`);

                  actualizarPaginacion(count);
              }


          function obtenerAmenidadesDePropiedad(propiedad) {
            const amenidades = [];

            if (propiedad.garage) amenidades.push('Garaje');
            if (propiedad.atico) amenidades.push('Ático');
            if (propiedad.estacionamiento) amenidades.push('Estacionamiento');
            if (propiedad.terraza) amenidades.push('Terraza');
            if (propiedad.cuarto_lavado) amenidades.push('Cuarto de Lavado');
            if (propiedad.areas_verdes) amenidades.push('Áreas Verdes');

            return amenidades;
          }
          async function llenarTabla(pagina = 1, nombre = '') {
            const propiedades = await obtenerPropiedades(pagina, nombre);
            const tbody = document.querySelector('.t-body');

            // Limpieza de tbody
            tbody.innerHTML = '';

            propiedades.forEach(propiedad => {
              const tr = document.createElement('tr');

              // Columna de la Propiedad
              const tdPropiedad = document.createElement('th');
              tdPropiedad.innerHTML = `
              <tr>
                <th scope="row">
                  <div class="listing-style1 dashboard-style d-xxl-flex flex-column align-items-left mb-0">
                    <div class="list-thumb" style="padding-bottom: 105px;">
                      <img class="w-100" src="images/listings/list-1.jpg" alt="">
                    </div>
                    <div class="list-content py-0 p-0 mt-2 mt-xxl-0">
                      <div class="h6 list-title"><a href="page-property-single-v1.html">${propiedad.nombre}</a></div>
                      <p class="list-text mb-0">${propiedad.direccion}, ${propiedad.ciudad}</p>
                    </div>
                  </div>
                </th>
              `;


              // Columna del Precio
              const tdPrecio = document.createElement('td');
              tdPrecio.innerHTML = `
              <td class="vam">
                <div class="list-price"><p href="">$${propiedad.precio}/<span>mo</span></p></div>
              </td>`;

              // Columna de Amenidades
              const tdAmenidades = document.createElement('td');
              const amenidades = obtenerAmenidadesDePropiedad(propiedad);
              
              tdAmenidades.innerHTML = `
                <td class="vam">
                  <ul class="ps-0" style="list-style-type: none; padding: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    ${amenidades.map(amenidad => `<li> - ${amenidad}</li>`).join('')}
                  </ul>
                </td>
              `;

              // Columna de Medidas
              const tdMedidas = document.createElement('td');
              tdMedidas.innerHTML = `
                <td class="vam">
                  <ul class="ps-0" style="list-style-type: none; padding: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    <li> Construcción: ${propiedad.metros_construccion} m² </li>
                    <li> Terreno: ${propiedad.metros_terreno} m² </li>
                  </ul>
                </td>
              `;

              // Columna de Acciones
              const tdAcciones = document.createElement('td');
              tdAcciones.innerHTML = `
                  <td class="vam">
                    <div class="d-flex">
                      <a href="page-dashboard-properties-edited.html?id=${propiedad.id}"" class="icon" data-id="${propiedad.id}" onclick="editarPropiedad(event)" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit">
                        <span class="fas fa-pen fa"></span>
                      </a>
                      <a href="#" class="icon" data-id="${propiedad.id}" onclick="eliminarPropiedad(event)" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete">
                        <span class="flaticon-bin"></span>
                      </a>
                    </div>
                  </td>
                </tr>
              `;

              tr.appendChild(tdPropiedad);
              tr.appendChild(tdPrecio);
              tr.appendChild(tdAmenidades);
              tr.appendChild(tdMedidas);
              tr.appendChild(tdAcciones);

              // Agregar la fila a tbody
              tbody.appendChild(tr);
            });
          }
          async function eliminarPropiedad(event) {
              event.preventDefault(); 
              const id = event.currentTarget.getAttribute('data-id'); 

              if (!id) {
                  console.error('ID no proporcionado. No se puede eliminar la propiedad.');
                  return;
              }

              // Muestra el modal
              const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
              confirmationModal.show();

              // Establecer el comportamiento cuando se haga clic en el botón de eliminar en el modal
              document.getElementById('confirmDelete').onclick = async function() {
                  // Llamada a Supabase para eliminar la propiedad
                  const { data, error } = await _supabase.from('propiedades').delete().eq('id', id);

                  if (error) {
                      console.error('Error eliminando propiedad:', error);
                      return;
                  }

                  // Llamar a llenarTabla para actualizar el DOM después de eliminar
                  await llenarTabla(paginaActual);

                  // Ocultar el modal
                  confirmationModal.hide();
              }
          }
          let paginaActual = 1;

          function actualizarPaginacion(totalPropiedades) {
            const elementosPorPagina = 9;
            const totalPaginas = Math.ceil(totalPropiedades / elementosPorPagina);
            const ulPaginacion = document.querySelector('.page_navigation');

            // Limpieza de ulPaginacion
            ulPaginacion.innerHTML = '';

            // Añadir paginación...
            for (let i = 1; i <= totalPaginas; i++) {
              const li = document.createElement('li');
              li.className = 'page-item';
              if (i === paginaActual) {
                li.className += ' active';
              }
              li.innerHTML = `<a class="page-link" href="#" onclick="cambiarPagina(${i})">${i}</a>`;
              ulPaginacion.appendChild(li);
            }
          }

          async function cambiarPagina(pagina) {
            paginaActual = pagina;
            await llenarTabla(pagina);
            
            const { count } = await _supabase.from('propiedades').select('*', { count: 'exact' });
            actualizarPaginacion(count);
          }

          // Obtener el total de propiedades al cargar la página para la paginación
          document.addEventListener('DOMContentLoaded', async () => {
            const { count } = await _supabase.from('propiedades').select('*', { count: 'exact' });
            actualizarPaginacion(count);
          });


                    // Llamar a la función cuando el DOM esté listo
                    document.addEventListener('DOMContentLoaded', () => {
            llenarTabla(paginaActual);
          });


        </script>
        <footer class="dashboard_footer pt30 pb10">
          <div class="container">
            <div class="row items-center justify-content-center justify-content-md-between">
              <div class="col-auto">
                <div class="copyright-widget">
                  <p class="copyright-text ff-heading">
                    © Asesorista - Copyright 2023 | Desarrollado por
                    <a href="https://www.amoxtlidev.com"
                      >Amoxtli Web Developers</a
                    >
                  </p>
                </div>
              </div>
              <div class="col-auto">
                <div class="footer_bottom_right_widgets text-center text-lg-end">
                  <p class="footer-menu ff-heading">
                    <a href="#">Política de Privaciodad</a>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>
  <a class="scrollToHome" href="#"><i class="fas fa-angle-up"></i></a>
</div>
<!-- Wrapper End -->
<script src="js/jquery-3.6.4.min.js"></script> 
<script src="js/jquery-migrate-3.0.0.min.js"></script> 
<script src="js/popper.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/bootstrap-select.min.js"></script> 
<script src="js/jquery.mmenu.all.js"></script> 
<script src="js/ace-responsive-menu.js"></script>
<script src="js/jquery-scrolltofixed-min.js"></script>
<script src="js/dashboard-script.js"></script>
<!-- Custom script for all pages --> 
<script src="js/script.js"></script>
</body>
</html>